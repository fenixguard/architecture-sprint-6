# Описание технологической архитектуры InsureTech

## Стратегия масштабирования и отказоустойчивости

### Масштабирование
- **Горизонтальное масштабирование**:
  - Приложение развернуто в независимых кластерах Kubernetes в двух зонах доступности Yandex Cloud.
  - Увеличение числа узлов в каждом кластере при росте нагрузки.
  - Добавление новых зон доступности при дальнейшем расширении.
- **Вертикальное масштабирование**:
  - Возможность увеличения ресурсов на уровне отдельных узлов (CPU, RAM).
  - Применяется только при исчерпании возможностей горизонтального масштабирования.

Вывод: предпочтение отдается горизонтальному масштабированию, так как оно более гибкое и устойчивое к отказам.

### Отказоустойчивость
- **Дополнительные зоны безопасности**: используется две зоны доступности для обеспечения высокой доступности приложения.
- **Показатели отказоустойчивости**:
  - RTO (максимально допустимое время восстановления): 45 минут.
  - RPO (максимально допустимая потеря данных): 15 минут.
- **Гарантированная доступность**: 99,9% за счет распределения нагрузки и дублирования данных.

## Конфигурация развёртывания приложения в Kubernetes

- Выбрана стратегия использования **независимых кластеров Kubernetes** в каждой зоне доступности.
  - Преимущества:
    - Минимизация риска глобальных отказов.
    - Лучшая локализация трафика и данных в рамках зоны.
    - Простота управления конфигурацией в рамках каждой зоны.
  - На схеме это отражено в виде двух независимых Kubernetes кластеров: `Kubernetes Cluster 1` и `Kubernetes Cluster 2`.

## Балансировка нагрузки

- Используется **глобальный балансировщик нагрузки** (Yandex Application Load Balancer):
  - Распределяет трафик между зонами доступности.
  - Выполняет регулярные **health check** для определения состояния сервисов.
  - Поддерживает маршрутизацию запросов к ближайшей географической зоне для минимизации задержек.
  - На схеме указаны связи между балансировщиком и кластерами Kubernetes.

## Фейловер-стратегия

- При отказе одной зоны доступности балансировщик:
  - Перенаправляет весь трафик в рабочую зону.
  - Выполняет повторные health check для восстановления связи с отказавшей зоной.
- Данные пользователей остаются доступными за счет репликации базы данных между зонами.

## Конфигурация базы данных

- **Тип базы данных**: PostgreSQL.
- **Репликация**:
  - Используется master-replica конфигурация.
  - Master-узел находится в первой зоне доступности.
  - Replica-узел расположен во второй зоне доступности.
  - Асинхронная репликация обеспечивает соответствие RTO и RPO.
- **Резервное копирование**:
  - Регулярное сохранение данных в Yandex Object Storage.
  - Возможность восстановления данных из бэкапа в любой из зон.
- **Шардирование**:
  - На текущий момент не применяется из-за небольшого объема данных (50 GB).
  - Возможность внедрения шардирования при увеличении объема данных.

## Итоговая схема
Схема архитектуры представлена в файле [drawio](to-be.drawio) и содержит следующие компоненты:
- Две зоны доступности с независимыми кластерами Kubernetes.
- Глобальный балансировщик нагрузки.
- Master-репликация базы данных PostgreSQL.
- Хранилище резервных копий.


